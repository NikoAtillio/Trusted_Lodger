{% extends 'base.html' %}
{% load static %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/managelisting.css' %}">
<link rel="stylesheet" href="{% static 'css/search.css' %}">
{% endblock %}

{% block content %}
<div class="container">
    <div class="search-grid">
        <!-- Filter Form -->
        <aside>
            <form action="{% url 'searches:search_results' %}" method="GET" id="filterForm" class="search-widget-form">
                <section id="searchWidget" class="panel panel-header-closed search-widget panel-standard">
                    <header>
                        <h3 id="search-for-title">Search Filters</h3>
                    </header>
                    <div>
                        <div class="form-group__radio">
                            <input type="radio" name="flatshare_type" value="offered" id="flatshare_type-offered" {% if request.GET.flatshare_type == "offered" %}checked{% endif %}>
                            <label for="flatshare_type-offered">Rooms for Rent</label>
                        </div>
                        <div class="form-group__radio">
                            <input type="radio" name="flatshare_type" value="wanted" id="flatshare_type-wanted" {% if request.GET.flatshare_type == "wanted" %}checked{% endif %}>
                            <label for="flatshare_type-wanted">Rooms Wanted</label>
                        </div>
                        <div class="form-group__radio">
                            <input type="radio" name="flatshare_type" value="buddyup" id="flatshare_type-buddyup" {% if request.GET.flatshare_type == "buddyup" %}checked{% endif %}>
                            <label for="flatshare_type-buddyup">Buddy Ups</label>
                        </div>
                        <div class="form-group">
                            <label for="search_by_location_field">Search Location</label>
                            <input type="text" name="location" id="search_by_location_field" value="{{ request.GET.location }}" placeholder="e.g., Bristol">
                        </div>
                        <div class="form-group">
                            <label for="radius">Search Radius</label>
                            <select name="radius" id="radius">
                                <option value="0" {% if request.GET.radius == "0" %}selected{% endif %}>This area only</option>
                                <option value="5" {% if request.GET.radius == "5" %}selected{% endif %}>5 miles</option>
                                <option value="10" {% if request.GET.radius == "10" %}selected{% endif %}>10 miles</option>
                                <option value="20" {% if request.GET.radius == "20" %}selected{% endif %}>20 miles</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="price_min">Min Price (£)</label>
                            <input type="number" name="price_min" id="price_min" value="{{ request.GET.price_min }}">
                        </div>
                        <div class="form-group">
                            <label for="price_max">Max Price (£)</label>
                            <input type="number" name="price_max" id="price_max" value="{{ request.GET.price_max }}">
                        </div>
                        <div class="form-group">
                            <label for="room_size">Room Size</label>
                            <select name="room_size" id="room_size">
                                <option value="" {% if not request.GET.room_size %}selected{% endif %}>Any</option>
                                <option value="Single" {% if request.GET.room_size == "Single" %}selected{% endif %}>Single</option>
                                <option value="Double" {% if request.GET.room_size == "Double" %}selected{% endif %}>Double</option>
                            </select>
                        </div>
                        <aside>
                            <form method="GET" id="filterForm" class="search-widget-form">
                                {{ form.as_p }}
                                <button type="submit" class="button button--wide">Search</button>
                            </form>
                        </aside>                    </div>
                </section>
            </form>
        </aside>

        <!-- Search Results -->
        <main>
            <h1>Search Results</h1>
            <ul>
                {% for listing in listings %}
                <li class="listing-card">
                    <div class="listing-header">
                        {% if listing.get_main_image %}
                        <img src="{{ listing.get_main_image }}" alt="{{ listing.title }}" class="listing-image">
                        {% else %}
                        <img src="{% static 'images/default-room.jpg' %}" alt="Default Room Image" class="listing-image">
                        {% endif %}
                        <div>
                            <h2>{{ listing.title }}</h2>
                            <p><strong>Location:</strong> {{ listing.location }}</p>
                            <p><strong>Price:</strong> £{{ listing.price }} / month</p>
                            <p><strong>Room Size:</strong> {{ listing.size }}</p>
                            <p><strong>Description:</strong> {{ listing.description|truncatewords:20 }}</p>
                            <button class="expand-button">View Details</button>
                        </div>
                    </div>

                    <!-- Expandable details -->
                    <div class="listing-details" style="display: none;">
                        <p><strong>Postcode:</strong> {{ listing.postcode }}</p>
                        <p><strong>Available From:</strong> {{ listing.available_from }}</p>
                        <p><strong>Minimum Term:</strong> {{ listing.minimum_term }} months</p>
                        <p><strong>Maximum Term:</strong> {{ listing.maximum_term }} months</p>
                        <p><strong>Deposit:</strong> £{{ listing.deposit }}</p>
                        <p><strong>Bills Included:</strong> {{ listing.bills_included }}</p>
                        <p><strong>Furnishings:</strong> {{ listing.furnishings }}</p>
                        <p><strong>Parking:</strong> {{ listing.parking }}</p>
                        <p><strong>Garden/Patio:</strong> {{ listing.garden }}</p>
                        <p><strong>Balcony/Roof Terrace:</strong> {{ listing.balcony }}</p>
                        <p><strong>Disabled Access:</strong> {{ listing.disabled_access }}</p>
                        <p><strong>Living Room:</strong> {{ listing.living_room }}</p>
                        <p><strong>Broadband Included:</strong> {{ listing.broadband }}</p>
                        <p><strong>Current Household:</strong> {{ listing.current_household }}</p>
                        <p><strong>Total Rooms:</strong> {{ listing.total_rooms }}</p>
                        <p><strong>Ages:</strong> {{ listing.ages }}</p>
                        <p><strong>Smoker:</strong> {{ listing.smoker }}</p>
                        <p><strong>Pets:</strong> {{ listing.pets }}</p>
                        <p><strong>Occupation:</strong> {{ listing.occupation }}</p>
                        <p><strong>Gender:</strong> {{ listing.gender }}</p>
                        <p><strong>Couples OK:</strong> {{ listing.couples_ok }}</p>
                        <p><strong>Smoking OK:</strong> {{ listing.smoking_ok }}</p>
                        <p><strong>Pets OK:</strong> {{ listing.pets_ok }}</p>
                        <p><strong>Preferred Occupation:</strong> {{ listing.occupation_preference }}</p>
                        <p><strong>References Required:</strong> {{ listing.references_required }}</p>
                        <p><strong>Min Age:</strong> {{ listing.min_age }}</p>
                        <p><strong>Max Age:</strong> {{ listing.max_age }}</p>
                    </div>
                </li>
                {% empty %}
                <p>No results found. Try adjusting your filters.</p>
                {% endfor %}
            </ul>
        </main>
    </div>
</div>
{% endblock %}