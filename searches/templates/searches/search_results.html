{% extends 'base.html' %}

{% block content %}
<div class="search-results-container">
    <h2>Search Results</h2>
    <p>{{ total_results }} results found for "{{ search_location }}"</p>

    <!-- Filters Section -->
    <div class="filters-container">
        <form id="filters-form" action="{% url 'searches:search_results' %}" method="get">
            <!-- Location -->
            <div class="form-group">
                <label for="location">Location:</label>
                <input type="text" id="location" name="location" value="{{ form.location.value }}" placeholder="Enter city, town, or postcode" />
            </div>

            <!-- Room Size -->
            <div class="form-group">
                <label for="room_size">Room Size:</label>
                <select id="room_size" name="room_size">
                    <option value="any" {% if form.room_size.value == "any" %}selected{% endif %}>Any</option>
                    <option value="Single" {% if form.room_size.value == "Single" %}selected{% endif %}>Single Room</option>
                    <option value="Double" {% if form.room_size.value == "Double" %}selected{% endif %}>Double Room</option>
                    <option value="Ensuite" {% if form.room_size.value == "Ensuite" %}selected{% endif %}>Ensuite Room</option>
                    <option value="Studio" {% if form.room_size.value == "Studio" %}selected{% endif %}>Studio</option>
                </select>
            </div>

            <!-- Price Range -->
            <div class="form-group">
                <label for="min_rent">Price Range (£/month):</label>
                <input type="number" id="min_rent" name="min_rent" value="{{ form.min_rent.value }}" placeholder="Min" />
                <input type="number" id="max_rent" name="max_rent" value="{{ form.max_rent.value }}" placeholder="Max" />
            </div>

            <!-- Property Type -->
            <div class="form-group">
                <label>Property Type:</label>
                {% for choice in form.property_type.field.choices %}
                    <label>
                        <input type="checkbox" name="property_type" value="{{ choice.0 }}" {% if choice.0 in form.property_type.value %}checked{% endif %} />
                        {{ choice.1 }}
                    </label>
                {% endfor %}
            </div>

            <!-- Search Type -->
            <div class="form-group">
                <label>Search Type:</label>
                {% for choice in form.search_type.field.choices %}
                    <label>
                        <input type="radio" name="search_type" value="{{ choice.0 }}" {% if form.search_type.value == choice.0 %}checked{% endif %} />
                        {{ choice.1 }}
                    </label>
                {% endfor %}
            </div>

            <!-- Keywords -->
            <div class="form-group">
                <label for="keywords">Keywords:</label>
                <input type="text" id="keywords" name="keywords" value="{{ form.keywords.value }}" placeholder="Search by keywords..." />
            </div>

            <!-- Submit Button -->
            <button type="submit" class="btn-primary">Apply Filters</button>
        </form>
    </div>

    <!-- Results Section -->
    <div class="results-container">
        {% if listings %}
            {% for listing in listings %}
                <div class="listing-card">
                    <h3>{{ listing.title }}</h3>
                    <p><strong>Location:</strong> {{ listing.location }}</p>
                    <p><strong>Price:</strong> £{{ listing.price }} / month</p>
                    <p><strong>Room Size:</strong> {{ listing.size }}</p>
                    <p><strong>Description:</strong> {{ listing.description|truncatewords:20 }}</p>
                    <a href="{% url 'searches:property_detail' listing.pk %}" class="btn-secondary">View Details</a>
                </div>
            {% endfor %}
        {% else %}
            <p>No results found. Try adjusting your filters.</p>
        {% endif %}
    </div>

    <!-- Pagination -->
    <div class="pagination-container">
        {% if listings.has_previous %}
            <a href="?{% if request.GET.page %}page={{ listings.previous_page_number }}&{% endif %}{{ request.GET.urlencode }}" class="btn-secondary">Previous</a>
        {% endif %}
        <span>Page {{ listings.number }} of {{ listings.paginator.num_pages }}</span>
        {% if listings.has_next %}
            <a href="?{% if request.GET.page %}page={{ listings.next_page_number }}&{% endif %}{{ request.GET.urlencode }}" class="btn-secondary">Next</a>
        {% endif %}
    </div>
</div>
{% endblock %}