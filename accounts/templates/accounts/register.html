{% extends 'base.html' %}
{% load static %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/register.css' %}" />
<!-- <script src="https://www.google.com/recaptcha/api.js" async defer></script> -->
{% endblock %}

{% block content %}
{% if form.non_field_errors %}
<div class="error-messages">
    {% for error in form.non_field_errors %}
        <div class="field-error">{{ error }}</div>
    {% endfor %}
</div>
{% endif %}

<div class="register-form">
  <h2>Register</h2>

  <form method="post" enctype="multipart/form-data" onsubmit="return validateForm()">
    {% csrf_token %}

    <div class="form-section">
      <h3>Register with your email</h3>

      <div class="form-group">
        <label for="{{ form.first_name.id_for_label }}">First Name:</label>
        {{ form.first_name }} 
        {% if form.first_name.errors %}
            <div class="field-error">{{ form.first_name.errors.0 }}</div>
        {% endif %}
      </div>

      <div class="form-group">
        <label for="{{ form.last_name.id_for_label }}">Last Name:</label>
        {{ form.last_name }} 
        {% if form.last_name.errors %}
            <div class="field-error">{{ form.last_name.errors.0 }}</div>
        {% endif %}
      </div>

      <div class="form-group">
        <label for="{{ form.email.id_for_label }}">Email:</label>
        {{ form.email }} 
        {% if form.email.errors %}
            <div class="field-error">{{ form.email.errors.0 }}</div>
        {% endif %}
      </div>

      <div class="form-group">
        <label for="{{ form.password1.id_for_label }}">Password:</label>
        {{ form.password1 }} 
        {% if form.password1.errors %}
            <div class="field-error">{{ form.password1.errors.0 }}</div>
        {% endif %}
      </div>

      <div class="form-group">
        <label for="{{ form.password2.id_for_label }}">Confirm Password:</label>
        {{ form.password2 }} 
        {% if form.password2.errors %}
            <div class="field-error">{{ form.password2.errors.0 }}</div>
        {% endif %}
      </div>
    </div>

    <div class="form-group">
        <label class="label-text">I am a:</label>
        <div class="user-type-group">
            <label>
                <input type="radio" name="user_type" value="tenant" required>
                Tenant
            </label>
            <label>
                <input type="radio" name="user_type" value="landlord" required>
                Landlord
            </label>
        </div>
        {% if form.user_type.errors %}
            <div class="field-error">{{ form.user_type.errors.0 }}</div>
        {% endif %}
    </div>

    <div class="form-section">
      <div class="form-group radio-group">
        <div class="label-text">Gender:</div>
        <div class="input-container">
          <label><input type="radio" name="gender" value="male" required /> Male</label>
          <label><input type="radio" name="gender" value="female" required /> Female</label>
          <label><input type="radio" name="gender" value="other" required /> Other</label>
          <input type="text" name="gender_other" id="gender_other" placeholder="Please specify" style="display: none" />
          <label><input type="radio" name="gender" value="prefer_not_to_say" required /> Prefer not to say</label>
        </div>
      </div>
    </div>

    <div class="form-section">
        <div class="form-group">
            <div class="label-text">Date of Birth:</div>
            <div class="dob-container">
                <input type="text" name="dob_day" id="dob_day" placeholder="DD" maxlength="2" required />
                <input type="text" name="dob_month" id="dob_month" placeholder="MM" maxlength="2" required />
                <input type="text" name="dob_year" id="dob_year" placeholder="YYYY" maxlength="4" required />
            </div>
            <p>You must be 18 or over to use Trusted Lodger</p>
        </div>
    </div>

    <div class="form-section">
      <div class="form-group checkbox-group">
        <div class="label-text">Tick those which apply to you:</div>
        <div class="input-container">
          <label><input type="checkbox" name="user_status" value="looking_for_share" /> I am looking for a flat or house share</label>
          <label><input type="checkbox" name="user_status" value="have_share" /> I have a flat or house share</label>
          <label><input type="checkbox" name="user_status" value="find_people" /> I'd like to find people to form a new share</label>
        </div>
        <div class="error" id="status-error" style="display: none">Please select at least one option.</div>
      </div>
    </div>

    <div class="form-section">
      <div class="form-group">
        <label for="profile_picture">Upload a Profile Picture (optional):</label>
        <input type="file" name="profile_picture" id="profile_picture" accept="image/*" />
      </div>
    </div>

    <button type="submit" class="btn btn-primary">Register now</button>
    <p>
      * By clicking Register now you agree to Trusted Lodger's terms and privacy policy. We will send you emails as part of the services we provide to you. You can unsubscribe at any time via the website or the link in the emails.
    </p>

    <!-- reCAPTCHA -->
    <!--  <div class="g-recaptcha" data-sitekey="6LezB8AqAAAAAM63Orsfx5NuHYQQ2Jr1vIPunaKs"></div> -->
  </form>

  <p class="login-text">
    Already have an account? <a href="{% url 'accounts:login' %}">Login here</a>.
  </p>
</div>

<script>
    // Facebook SDK Initialization
  /*  window.fbAsyncInit = function () {
    FB.init({
      appId: "2065671450512648",
      cookie: true,
      xfbml: true,
      version: "v22.0",
    });
    FB.AppEvents.logPageView();
  };

  function checkLoginState() {
    FB.getLoginStatus(function (response) {
      statusChangeCallback(response);
    });
  }

  function statusChangeCallback(response) {
    if (response.status === "connected") {
      console.log("User is logged in:", response);
      window.location.href = "/accounts/facebook-login-success/";
    } else {
      console.log("User is not logged in:", response);
    }
  }

  document.querySelectorAll('input[name="gender"]').forEach((elem) => {
    elem.addEventListener("change", function (event) {
      const otherInput = document.getElementById("gender_other");
      if (event.target.value === "other") {
        otherInput.style.display = "inline";
      } else {
        otherInput.style.display = "none";
        otherInput.value = "";
      }
    });
  });

  function validateForm() {
    const checkboxes = document.querySelectorAll('input[name="user_status"]');
    const errorElement = document.getElementById("status-error");
    let isChecked = false;
    checkboxes.forEach((checkbox) => {
      if (checkbox.checked) {
        isChecked = true;
      }
    });
    if (!isChecked) {
      errorElement.style.display = "block";
      return false; // Prevent form submission
    }
    errorElement.style.display = "none"; // Hide error if checked
    return true; // Allow form submission
  } */
   
</script>
{% endblock %}