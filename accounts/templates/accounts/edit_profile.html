{% extends 'base.html' %}
{% load static %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/editprofile.css' %}" />
{% endblock %}

{% block content %}
<div class="edit-profile-container">
    <h2 class="text-2xl font-bold mb-6">Profile - {{ user.first_name }} {{ user.last_name }}</h2>

    <!-- View Mode -->
    <div id="view-mode">
        <div class="profile-grid">
            <!-- Profile Photo Section -->
            <div class="profile-section">
                <div class="section-header">
                    <i class="fas fa-camera"></i>
                    <h3>Profile Photo</h3>
                </div>
                <div class="profile-photo-container">
                    <img src="{% if user.profile_picture %}{{ user.profile_picture.url }}{% else %}{% static 'images/icons/user-icon.png' %}{% endif %}"
                         alt="Profile Picture" class="profile-photo">
                </div>
            </div>

            <!-- Basic Information Section -->
            <div class="profile-section">
                <div class="section-header">
                    <i class="fas fa-user"></i>
                    <h3>Basic Information</h3>
                </div>
                <div class="info-group">
                    <p><strong>First Name:</strong> {{ user.first_name }}</p>
                    <p><strong>Last Name:</strong> {{ user.last_name }}</p>
                    <p><strong>Email:</strong> {{ user.email }}</p>
                    <p><strong>Gender:</strong> {{ user.get_gender_display }}</p>
                    <p><strong>Date of Birth:</strong> {{ user.dob_day }}/{{ user.dob_month }}/{{ user.dob_year }}</p>
                </div>
            </div>

            <!-- Account Management Section -->
            <div class="profile-section">
                <div class="section-header">
                    <i class="fas fa-dollar-sign"></i>
                    <h3>Account Details</h3>
                </div>
                <div class="info-group">
                    <p><strong>Monthly Budget:</strong> {{ profile.budget|default:"Not specified" }}</p>
                    <p><strong>Occupation:</strong> {{ profile.occupation|default:"Not specified" }}</p>
                </div>
            </div>

            <!-- Availability Section -->
            <div class="profile-section">
                <div class="section-header">
                    <i class="fas fa-calendar-alt"></i>
                    <h3>Availability</h3>
                </div>
                <div class="info-group">
                    <p><strong>Available From:</strong> {{ profile.availability|date:"d/m/Y"|default:"Not specified" }}</p>
                </div>
            </div>

            <!-- Housing Status Section -->
            <div class="profile-section">
                <div class="section-header">
                    <i class="fas fa-home"></i>
                    <h3>Housing Status</h3>
                </div>
                <div class="info-group">
                    {% for status in user.user_status.split %}
                        <p>âœ“ {{ status|replace:"_":" "|title }}</p>
                    {% endfor %}
                </div>
            </div>
        </div>

        <button id="enable-edit" class="edit-button">
            <i class="fas fa-edit"></i> Edit Profile
        </button>
    </div>

    <!-- Edit Mode -->
    <div id="edit-mode" style="display: none;">
        <form method="post" enctype="multipart/form-data" onsubmit="return validateForm()">
            {% csrf_token %}
            
            <!-- Your existing form content here -->
            [Previous form sections remain the same]

            <div class="button-group">
                <button type="submit" class="save-button">
                    <i class="fas fa-save"></i> Save Changes
                </button>
                <button type="button" class="cancel-button" id="cancel-edit">
                    <i class="fas fa-times"></i> Cancel
                </button>
            </div>
        </form>
    </div>
</div>

<script>
    // Toggle edit mode
    document.getElementById('enable-edit').addEventListener('click', function() {
        document.getElementById('view-mode').style.display = 'none';
        document.getElementById('edit-mode').style.display = 'block';
    });

    document.getElementById('cancel-edit').addEventListener('click', function() {
        document.getElementById('edit-mode').style.display = 'none';
        document.getElementById('view-mode').style.display = 'block';
    });

    // Your existing JavaScript for gender and form validation

    document.querySelectorAll('input[name="gender"]').forEach((elem) => {
        elem.addEventListener("change", function(event) {
            const otherInput = document.getElementById("gender_other");
            if (event.target.value === "other") {
                otherInput.style.display = "block";
            } else {
                otherInput.style.display = "none";
                otherInput.value = "";
            }
        });
    });

    function validateForm() {
        const checkboxes = document.querySelectorAll('input[name="user_status"]');
        const errorElement = document.getElementById("status-error");
        let isChecked = false;
        checkboxes.forEach((checkbox) => {
            if (checkbox.checked) {
                isChecked = true;
            }
        });
        if (!isChecked) {
            errorElement.style.display = "block";
            return false;
        }
        errorElement.style.display = "none";
        return true;
    }
</script>
{% endblock %}