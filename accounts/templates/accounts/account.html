{% extends 'base.html' %}
{% load static %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/editprofile.css' %}" />
{% endblock %}

{% block content %}
<div class="edit-profile-container">
    <h2 class="text-2xl font-bold mb-6">Edit Profile - {{ user.first_name }} {{ user.last_name }}</h2>

    {% if form.non_field_errors %}
    <div class="error-messages">
        {% for error in form.non_field_errors %}
            <div class="field-error">{{ error }}</div>
        {% endfor %}
    </div>
    {% endif %}

    <form method="post" enctype="multipart/form-data">
        {% csrf_token %}

        <div class="profile-grid">
            <!-- Profile Photo Section -->
            <div class="profile-section">
                <div class="section-header">
                    <i class="fas fa-camera"></i>
                    <h3>Profile Photo</h3>
                </div>

                <div class="profile-photo-container">
                    <img src="{% if user.profile_picture %}{{ user.profile_picture.url }}{% else %}{% static 'images/icons/user-icon.png' %}{% endif %}"
                         alt="Profile Picture" class="profile-photo">
                </div>
                <label class="photo-upload-btn">
                    <i class="fas fa-upload"></i> Change Photo
                    <input type="file" name="profile_picture" accept="image/*" class="form-control">
                </label>
            </div>

            <!-- Basic Information Section -->
            <div class="profile-section">
                <div class="section-header">
                    <i class="fas fa-user"></i>
                    <h3>Basic Information</h3>
                </div>

                <div class="form-group">
                    <p>First Name: <span>{{profile.user.first_name}}</span></p>
                    <p>Last Name: <span>{{profile.user.last_name}}</span></p>
                    <p>Email: <span>{{profile.user.email}}</span></p>
                    <p>Gender: <span>{{profile.user.gender}}</span></p>
                </div>

                <div class="form-group">
                    <label for="{{ form.last_name.id_for_label }}">Last Name:</label>
                    {{ form.last_name }}
                    {% if form.last_name.errors %}
                        <div class="field-error">{{ form.last_name.errors.0 }}</div>
                    {% endif %}
                </div>

                <div class="form-group">
                    <label for="{{ form.email.id_for_label }}">Email:</label>
                    {{ form.email}}
                    {% if form.email.errors %}
                        <div class="field-error">{{ form.email.errors.0 }}</div>
                    {% endif %}
                </div>

                <div class="form-group">
                    <label for="password">Change Password:</label>
                    <input type="password" name="password" class="form-control" placeholder="New Password">
                </div>

                <div class="form-group">
                    <label for="confirm_password">Confirm Password:</label>
                    <input type="password" name="confirm_password" class="form-control" placeholder="Confirm New Password">
                </div>
            </div>

            <!-- Merged Budget and Account Management Section -->
            <div class="profile-section">
                <div class="section-header">
                    <i class="fas fa-dollar-sign"></i>
                    <h3>Account Management</h3>
                </div>

                <div class="form-group">
                    <label for="budget">Monthly Budget:</label>
                    <input type="text" name="budget" class="form-control" value="{{ profile.budget }}">
                </div>

                <div class="form-group">
                    <label>Gender:</label>
                    <div class="gender-options">
                        <label><input type="radio" name="gender" value="male" {% if profile.gender == 'male' %}checked{% endif %}> Male</label>
                        <label><input type="radio" name="gender" value="female" {% if profile.gender == 'female' %}checked{% endif %}> Female</label>
                        <label><input type="radio" name="gender" value="other" {% if profile.gender == 'other' %}checked{% endif %}> Other</label>
                        <input type="text" id="gender_other" name="gender_other" placeholder="Specify" style="display: {% if profile.gender == 'other' %}block{% else %}none{% endif %};">
                    </div>
                </div>

                <div class="form-group">
                    <label>Date of Birth:</label>
                    <div class="dob-inputs">
                        <input type="number" name="dob_day" placeholder="DD" class="dob-input" value="{{ profile.dob_day }}">
                        <input type="number" name="dob_month" placeholder="MM" class="dob-input" value="{{ profile.dob_month }}">
                        <input type="number" name="dob_year" placeholder="YYYY" class="dob-input" value="{{ profile.dob_year }}">
                    </div>
                </div>

                <div class="form-group">
                    <label for="occupation">Occupation:</label>
                    <input type="text" name="occupation" class="form-control" value="{{ profile.occupation }}">
                </div>
            </div>

            <!-- Availability Section -->
            <div class="profile-section">
                <div class="section-header">
                    <i class="fas fa-calendar-alt"></i>
                    <h3>Availability</h3>
                </div>

                <div class="form-group">
                    <label for="availability">Available From:</label>
                    <input type="date" name="availability" class="form-control" value="{{ profile.availability }}">
                </div>
            </div>

            <!-- User Status Section -->
            <div class="profile-section">
                <div class="section-header">
                    <i class="fas fa-home"></i>
                    <h3>Housing Status</h3>
                </div>

                <div class="form-group checkbox-group">
                    <div class="label-text">Tick those which apply to you:</div>
                    <div class="input-container">
                        <label><input type="checkbox" name="user_status" value="looking_for_share" {% if 'looking_for_share' in profile.user_status %}checked{% endif %}/> I am looking for a flat or house share</label>
                        <label><input type="checkbox" name="user_status" value="have_share" {% if 'have_share' in profile.user_status %}checked{% endif %}/> I have a flat or house share</label>
                        <label><input type="checkbox" name="user_status" value="find_people" {% if 'find_people' in profile.user_status %}checked{% endif %}/> I'd like to find people to form a new share</label>
                    </div>
                    <div class="error" id="status-error" style="display: none">Please select at least one option.</div>
                </div>
            </div>

            <!-- Delete Account Section -->
            <div class="profile-section">
                <div class="section-header">
                    <i class="fas fa-trash-alt"></i>
                    <h3>Account Management</h3>
                </div>

                <div class="form-group">
                    <p>If you wish to delete your account, please click the button below:</p>
                    <a href="{% url 'accounts:delete_profile' %}" class="delete-profile-btn">Delete Account</a>
                </div>
            </div>
        </div>

        <button type="submit" class="save-button">
            <i class="fas fa-save"></i> Save Changes
        </button>
    </form>
</div>
{% endblock %}